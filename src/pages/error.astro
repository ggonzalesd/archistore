---
import Layout from '@/layouts/Layout.astro';

const error = Astro.locals.error;

if (error == null) {
  return Astro.redirect('/');
}

Astro.response.headers.set(
  'Cache-Control',
  'no-store, no-cache, must-revalidate'
);

Astro.response.status = error.status;
---

<Layout title='Error'>
  <section
    class='mx-auto flex h-screen w-full max-w-screen-lg flex-col items-center justify-center gap-6'
  >
    <span
      error-title
      class='bg-gradient-to-tr from-red-400 to-red-500 bg-clip-text text-7xl font-bold text-transparent'
      >Error {error.status}</span
    >
    <pre
      class='w-full max-w-screen-md whitespace-pre-wrap break-all rounded-md bg-zinc-800 p-4 text-sm shadow-inner shadow-zinc-950'><code error-content>{error.message ?? 'Error'}</code></pre>
    <div class='flex justify-center'>
      <button
        copy-text
        type='button'
        class='rounded-md bg-red-700 p-2 text-white hover:bg-red-600'
        >Copy Error</button
      >
    </div>
  </section>
</Layout>

<style scoped>
  span[error-title] {
    text-shadow: 0px 0px 20px #f444;
  }
</style>

<script is:inline define:vars={{ value: error.message }}>
  const btn = document.querySelector('button[copy-text]');

  if (btn instanceof HTMLButtonElement) {
    btn.addEventListener('click', () => {
      navigator.clipboard?.writeText(value);
    });
  }
</script>
